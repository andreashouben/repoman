<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: auth/github.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: auth/github.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var bag = require('bagofrequest');
var github = require('@octokit/rest');
var url = require('url');
var dotfile = require('dotfile')('repomanrc');
var BluePromise = require('bluebird');

/**
 * Configuration generator for remote GitHub repositories.
 *
 * @param {String} user: GitHub username
 * @param {String} pass: GitHub password
 * @class
 */
function GithubAuth() {
  var opts = {
    version: '3.0.0',
    timeout: 30000
  };

  var proxy = bag.proxy();
  if (proxy) {
    proxy = url.parse(proxy);
    opts.proxy = {
      host: proxy.hostname,
      port: proxy.port
    };
  }

  this.gh = new github(opts);
}

GithubAuth.prototype.authBasic = function(user, pass) {
  return this.gh.authenticate({
    type: 'basic',
    username: user,
    password: pass
  });
};

GithubAuth.prototype.fetchAndStoreAuthToken = function(optionalTwoFactor) {
  var self = this;
  return new BluePromise(function(s, f) {
    var headers = {};
    if (optionalTwoFactor) {
      headers['X-GitHub-OTP'] = optionalTwoFactor;
    }
    self.gh.authorization.create(
      {
        scopes: ['user', 'public_repo', 'repo', 'repo:status', 'gist'],
        note: 'read repos for repoman4',
        headers: headers
      },
      function(err, res) {
        if (res &amp;&amp; res.data &amp;&amp; res.data.token) {
          self.ghToken = res.data.token;
          console.log('got Github auth token');

          dotfile.exists(function(yesno) {
            dotfile.write({ githubAuthToken: self.ghToken }, function(err) {
              dotfile.read(function(err, disk) {
                console.log('saved Github auth');
                console.log(disk);
                s();
              });
            });
          });
        } else if (err) {
          console.log(err);
          f(err);
        }
      }
    );
  });
};

GithubAuth.prototype.readAuthToken = function() {
  return new BluePromise(function(s, f) {
    dotfile.exists(function(yesno) {
      if (yesno) {
        dotfile.read(function(err, disk) {
          if (disk.githubAuthToken) {
            s(disk.githubAuthToken);
          } else {
            f(new Error('no auth token in dotfile'));
          }
        });
      } else {
        f(new Error('no dotfile'));
      }
    });
  });
};

module.exports = GithubAuth;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-cli.html">cli</a></li></ul><h3>Classes</h3><ul><li><a href="Bitbucket.html">Bitbucket</a></li><li><a href="GitHub.html">GitHub</a></li><li><a href="GithubAuth.html">GithubAuth</a></li><li><a href="Gitorious.html">Gitorious</a></li><li><a href="Local.html">Local</a></li><li><a href="Repoman.html">Repoman</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Thu Nov 14 2019 17:06:40 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
